version: 2

models:
  - name: dim_orders
    config:
      contract:
        enforced: true
    columns:
      - name: order_sk
        data_type: decimal(10,2)
        data_tests:
          - unique
          - not_null
      - name: cust_fname
        data_type: string
      - name: cust_lname
        data_type: string
      - name: order_country_origin
        data_type: string
      - name: order_date
        data_type: date
      - name: order_id
        data_type: string
      - name: order_quantity
        data_type: decimal(15,2)

  - name: dim_countries
    columns:
      - name: country_name
        data_tests:
          - accepted_values:
              values:
                - "United States"
                - "France"
                - "Italy"
                - "Philippines"

unit_tests:
  - name: test_if_full_name_format_is_correct
    description: "Checks if the format for customer full name is correct"
    model: dim_customer_info
    config:
      tags: |
        {%- if target.name == 'prod' -%} unit_test
        {%- else -%} do_not_run
        {% endif %}
    given:
      - input: ref('dim_orders')
        rows:
          - {"cust_fname": "Johnny", "cust_lname": "Bravo"}

    expect:
      rows:
        - {cust_fullname: "Bravo, Johnny"}